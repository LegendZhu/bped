### PHP 扩展的头文件

PHP 扩展至少有一个头文件，它的名字为 php_extname.h，其中 extname 为 PHP 扩展的名称。例如：在 xxtea 扩展中，这个文件就是 php_xxtea.h。

因为 xxtea 是一个小扩展，所以这个头文件本身就很小。如果我们要创建一个比较大的扩展，比如其中包含了近百个函数或多个类，那么我们应该把这些函数或类的声明分散到其它的头文件中，让这个头文件保持尽可能的小，只包含有限的一组声明。库或系统的头文件不应该被包含在其中。它一般也就包含扩展模块函数的声明（例如 PHP_MINIT_FUNCTION），模块的入口指针以及版本号的定义。至于原因嘛，简单来说就是为了加快同 PHP 一起静态编译时的速度，减少可能发生冲突的机会。

xxtea 扩展的头文件很简单，全部代码如下：

```c
/**********************************************************\
|                                                          |
| php_xxtea.h                                              |
|                                                          |
| XXTEA for pecl include file.                             |
|                                                          |
| Encryption Algorithm Authors:                            |
|      David J. Wheeler                                    |
|      Roger M. Needham                                    |
|                                                          |
| Code Author:  Ma Bingyao <mabingyao@gmail.com>           |
| LastModified: Apr 06, 2015                               |
|                                                          |
\**********************************************************/

#ifndef PHP_XXTEA_H
#define PHP_XXTEA_H

#ifdef HAVE_CONFIG_H
#include "config.h"
#endif

#include "php.h"

extern zend_module_entry xxtea_module_entry;
#define phpext_xxtea_ptr &xxtea_module_entry

#define PHP_XXTEA_MODULE_NAME   "xxtea"
#define PHP_XXTEA_BUILD_DATE    __DATE__ " " __TIME__
#define PHP_XXTEA_VERSION       "1.0.11"
#define PHP_XXTEA_AUTHOR        "Ma Bingyao"
#define PHP_XXTEA_HOMEPAGE      "https://github.com/xxtea/xxtea-pecl"

ZEND_MINIT_FUNCTION(xxtea);
ZEND_MSHUTDOWN_FUNCTION(xxtea);
ZEND_MINFO_FUNCTION(xxtea);

/* declaration of functions to be exported */
ZEND_FUNCTION(xxtea_encrypt);
ZEND_FUNCTION(xxtea_decrypt);
ZEND_FUNCTION(xxtea_info);

#endif /* ifndef PHP_XXTEA_H */
```

其中开头的注释不做解释了。

接下来的 `#ifndef PHP_XXTEA_H` 这几行也是 C 语言头文件的基本写法，这里也不多作解释了。

```c
#ifdef HAVE_CONFIG_H
#include "config.h"
#endif

#include "php.h"
```

这几行其实也可以不放在这个头文件中，放到扩展的主文件开头是一样的[^1]。不过那样的话，它后面的几行所使用的 `zend_module_entry` 这些类型，`ZEND_MINIT_FUNCTION` 这些宏，在这个头文件中就找不到定义了，在某些编辑器中打开可能会有错误提示。所以我把它放在了这个头文件中。反正这几行代码对静态编译不会有什么影响。

----
<small>[^1] ext_skel 生成的头文件中就不包含这几行，而是放在了扩展的主文件中。</small>